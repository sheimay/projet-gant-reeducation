#:kivy 2.2.0
#:import dp kivy.metrics.dp

<MenuScreen>:
    FloatLayout:
        # --- Fond du menu ---
        Image:
            source: "assets/menu_background.png"
            allow_stretch: True
            keep_ratio: False
            size: root.width, root.height
            pos: 0, 0

        # --- Contenu principal ---
        BoxLayout:
            orientation: "vertical"
            spacing: dp(24)
            size_hint: 0.9, 0.7
            pos_hint: {"center_x": 0.5, "center_y": 0.6}

            # Titre
            Label:
                text: "Programme de Rééducation Interactive"
                font_size: "28sp"
                bold: True
                color: 0.08, 0.13, 0.24, 1
                halign: "center"
                valign: "middle"
                text_size: self.size

            # Sous-titre
            Label:
                text: "Choisissez un mini-jeu pour travailler vos mouvements avec le gant."
                font_size: "16sp"
                color: 0.2, 0.3, 0.45, 1
                halign: "center"
                valign: "middle"
                text_size: self.size

            # --- Cartes de jeux (3 encadrés) ---
            BoxLayout:
                orientation: "horizontal"
                spacing: dp(20)
                size_hint_y: 0.6

                # -------- Carte 1 : Guidage Voiture --------
                Button:
                    background_normal: ""
                    background_color: 0, 0, 0, 0
                    size_hint_x: 1
                    on_release: app.root.current = "game"

                    canvas.before:
                        Color:
                            rgba: 1, 1, 1, 1
                        RoundedRectangle:
                            pos: self.pos
                            size: self.size
                            radius: [24, 24, 24, 24]

                    BoxLayout:
                        orientation: "vertical"
                        padding: dp(16)
                        spacing: dp(12)

                        Image:
                            source: "assets/icon_car.png"
                            allow_stretch: True
                            keep_ratio: True
                            size_hint_y: 0.7

                        Label:
                            text: "Guidage voiture"
                            font_size: "16sp"
                            bold: True
                            color: 0.08, 0.13, 0.24, 1
                            halign: "center"
                            valign: "middle"
                            text_size: self.size

                # -------- Carte 2 : Piano --------
                Button:
                    background_normal: ""
                    background_color: 0, 0, 0, 0
                    size_hint_x: 1
                    on_release: app.root.current = "piano"

                    canvas.before:
                        Color:
                            rgba: 1, 1, 1, 1
                        RoundedRectangle:
                            pos: self.pos
                            size: self.size
                            radius: [24, 24, 24, 24]

                    BoxLayout:
                        orientation: "vertical"
                        padding: dp(16)
                        spacing: dp(12)

                        Image:
                            source: "assets/icon_piano.png"
                            allow_stretch: True
                            keep_ratio: True
                            size_hint_y: 0.7

                        Label:
                            text: "Jeu piano"
                            font_size: "16sp"
                            bold: True
                            color: 0.08, 0.13, 0.24, 1
                            halign: "center"
                            valign: "middle"
                            text_size: self.size
                            source: "assets/icon_sparkle.png"
                            size_hint: None, None
                            size: dp(22), dp(22)
                            pos_hint: {"right": 0.95, "top": 0.95}
                            opacity: 0.85

                # -------- Carte 3 : Jump --------
                Button:
                    background_normal: ""
                    background_color: 0, 0, 0, 0
                    size_hint_x: 1
                    on_release: app.root.current = "game"  # plus tard: "jump"

                    canvas.before:
                        Color:
                            rgba: 1, 1, 1, 1
                        RoundedRectangle:
                            pos: self.pos
                            size: self.size
                            radius: [24, 24, 24, 24]

                    BoxLayout:
                        orientation: "vertical"
                        padding: dp(16)
                        spacing: dp(12)

                        Image:
                            source: "assets/icon_jump.png"
                            allow_stretch: True
                            keep_ratio: True
                            size_hint_y: 0.7

                        Label:
                            text: "Jump"
                            font_size: "16sp"
                            bold: True
                            color: 0.08, 0.13, 0.24, 1
                            halign: "center"
                            valign: "middle"
                            text_size: self.size

<GameScreen>:
    FloatLayout:
        # Bouton retour
        Button:
            text: "Retour"
            size_hint: None, None
            size: dp(120), dp(40)
            pos: dp(10), root.height - dp(50)
            on_release: app.root.current = "menu"

        # Route qui défile (2 images qui se suivent)
        Image:
            source: "assets/background.png"
            size_hint: 1, None
            height: root.height
            allow_stretch: True
            keep_ratio: False
            y: root.scroll_y

        Image:
            source: "assets/background.png"
            size_hint: 1, None
            height: root.height
            allow_stretch: True
            keep_ratio: False
            y: root.scroll_y + root.height

        # Voiture pilotée par car_x
        Image:
            source: "assets/car.png"
            size_hint: None, None
            size: dp(80), dp(160)
            x: root.car_x - self.width / 2
            y: dp(50)

        # Distance
        Label:
            text: "Distance : {:.1f} m".format(root.distance)
            size_hint: None, None
            size: dp(200), dp(40)
            pos: dp(10), dp(10)
            color: 1, 1, 1, 1


<PianoGameScreen>:
    # --- Fond sans texte ---
    canvas.before:
        Rectangle:
            source: "assets/piano_bg.jpg"
            pos: self.pos
            size: self.size

    FloatLayout:

        # --- Image du piano ---
        Image:
            source: "assets/piano_keys.png"
            allow_stretch: True
            keep_ratio: True
            size_hint: 0.45, 0.45
            pos_hint: {"center_x": 0.68, "y": 0.17}

        # --- Légende des touches (INDEX / MAJEUR) ---
        BoxLayout:
            orientation: "horizontal"
            spacing: dp(20)
            size_hint: 0.22, None
            height: dp(80)
            pos_hint: {"center_x": 0.68, "y": 0.52}

            # Badge INDEX (jaune)
            Image:
                source: "assets/index_bouton.png"
                allow_stretch: True
                keep_ratio: True
                opacity: 1.0 if root.index_badge_visible else 0.25

            # Badge MAJEUR (orange)
            Image:
                source: "assets/majeur_bouton.png"
                allow_stretch: True
                keep_ratio: True
                opacity: 1.0 if root.majeur_badge_visible else 0.25

        # --- Bouton retour ---
        Button:
            text: "Retour au menu"
            size_hint: 0.35, None
            height: dp(40)
            pos_hint: {"center_x": 0.5, "y": 0.02}
            background_normal: ""
            background_color: 0, 0, 0, 0.7
            color: 1, 1, 1, 1
            on_release: app.root.current = "menu"
